My voyage of discovery with Phusion Passenger, Enterprise Ruby, Git and
Capistrano.

Installed Phusion Passenger and Enterprise Ruby on Debian Lenny vmware instance
called lenny.vmware (also called lenny) and activated this virtual host in
apache:

<VirtualHost *:80>
  ServerName lenny.vmware
  DocumentRoot /var/www/apps/capsample/current/public
  RailsEnv development
</VirtualHost>

Created /var/www/apps/capsample/current/public on lenny and made sheldonh
its owner.

Copied my SSH public key over to lenny.

Created the rails app.

Created the repository at github.

Followed the getting started instructions for the repository at github.
This gets to the point where you have master and origin, and origin refers
to the repository at github.  So now github has the rails app.

Capify.  Committed to master without modification (but not pushed to origin),
in case I want to revert local mods.

Localized config/deploy.rb.

cap deploy:setup

Looked okay except for "zlib(finalizer): the stream was freed prematurely."
at the end, which I ignored.

cap deploy:check

Complained that git was missing so I installed git-core on lenny.

Created a do-nothing script/spin.

cap deploy:update

The find command failed because stylesheets releases/XXX/public/stylesheets
was missing.  This directory (and possibly others) is empty in a virgin
rails app, and so is not tracked by git.

Plus, I think I should have used cap deploy:update_code (which is update
minus symlink), so prevent passenger from picking up the deploy?

Anyway, added before_finalize_update task to config/deploy.rb to create
missing public/stylesheets directory.

Couldn't remember whether I'd reloaded apache after updating the DocumentRoot
for the passenger vhost, so I reloaded apache, and then browser to the site,
getting the "Welcome aboard" page.

Committed capistrano localizations to master and pushed to origin.

Modified config/deploy.rb to share sqlite3 databases across releases.

cap deploy:migrate

Failed because rake wasn't in the PATH.
Symlinked /opt/ruby-enterprise-.../bin/rake into /usr/local/bin on lenny,
then the migrate worked.

cap deploy

Failed to run script/process/reaper, because ruby wasn't in the PATH.
Symlinked /opt/ruby-enterprise-.../bin/ruby into /usr/local/bin on lenny,

Came up with a better fix for reaper.  If app_server is set to :passenger,
override the deploy:restart task to request a passenger restart properly.
But I left the ruby symlink in place, for the sake of "cap invoke".

Also added no-op start and stop targets for passenger.
